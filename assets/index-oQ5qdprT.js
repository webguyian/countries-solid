import{createContext as x,useContext as b,untrack as I,createSignal as C,getOwner as T,getListener as _,onCleanup as j,startTransition as O,sharedConfig as d}from"solid-js";import{isServer as u,getRequestEvent as w}from"solid-js/web";function D(e,r){if(e==null)throw new Error(r);return e}function M(e,r){const n=new URLSearchParams(e);Object.entries(r).forEach(([a,s])=>{s==null||s===""?n.delete(a):n.set(a,String(s))});const c=n.toString();return c?`?${c}`:""}const k=x();x();const m=()=>D(b(k),"<A> and 'use' router primitives can be only used inside a Route."),P=()=>m().navigatorFactory(),G=()=>m().location,z=()=>m().params,J=()=>{const e=G(),r=P(),n=(c,a)=>{const s=I(()=>e.pathname+M(e.search,c)+e.hash);r(s,{scroll:!1,resolve:!1,...a})};return[e.query,n]};let H;function N(){return H}const U="Location",q=5e3,v=18e4;let E=new Map;u||setInterval(()=>{const e=Date.now();for(let[r,n]of E.entries())!n[3].count&&e-n[0]>v&&E.delete(r)},3e5);function S(){if(!u)return E;const e=w();if(!e)throw new Error("Cannot find cache context");return(e.router||(e.router={})).cache||(e.router.cache=new Map)}function L(e,r){e.GET&&(e=e.GET);const n=(...c)=>{const a=S(),s=N(),A=T()?P():void 0,p=Date.now(),f=r+R(c);let t=a.get(f),y;if(u){const o=w();if(o){const i=(o.router||(o.router={})).dataOnly;if(i){const l=o&&(o.router.data||(o.router.data={}));if(l&&f in l)return l[f];if(Array.isArray(i)&&!i.includes(f))return l[f]=void 0,Promise.resolve()}}}if(_()&&!u&&(y=!0,j(()=>t[3].count--)),t&&t[0]&&(u||s==="native"||t[3].count||Date.now()-t[0]<q)){y&&(t[3].count++,t[3][0]()),t[2]==="preload"&&s!=="preload"&&(t[0]=p);let o=t[1];return o="then"in t[1]?t[1].then(g(!1),g(!0)):g(!1)(t[1]),!u&&s==="navigate"&&O(()=>t[3][1](t[0])),o}let h=!u&&d.context&&d.has(f)?d.load(f):e(...c);if(t?(t[0]=p,t[1]=h,t[2]=s,!u&&s==="navigate"&&O(()=>t[3][1](t[0]))):(a.set(f,t=[p,h,s,C(p)]),t[3].count=0),y&&(t[3].count++,t[3][0]()),u){const o=w();if(o&&o.router.dataOnly)return o.router.data[f]=h}if(h="then"in h?h.then(g(!1),g(!0)):g(!1)(h),u&&d.context&&d.context.async&&!d.context.noHydrate){const o=w();(!o||!o.serverOnly)&&d.context.serialize(f,h)}return h;function g(o){return async i=>{if(i instanceof Response){if(i.headers.has("Location")){A&&O(()=>{let l=i.headers.get(U);l&&l.startsWith("/")?A(l,{replace:!0}):!u&&l&&(window.location.href=l)});return}i.customBody&&(i=await i.customBody())}if(o)throw i;return i}}};return n.keyFor=(...c)=>r+R(c),n.key=r,n}L.set=(e,r)=>{const n=S(),c=Date.now();let a=n.get(e);a?(a[0]=c,a[1]=r,a[2]="preload"):(n.set(e,a=[c,r,,C(c)]),a[3].count=0)};L.clear=()=>S().clear();function R(e){return JSON.stringify(e,(r,n)=>B(n)?Object.keys(n).sort().reduce((c,a)=>(c[a]=n[a],c),{}):n)}function B(e){let r;return e!=null&&typeof e=="object"&&(!(r=Object.getPrototypeOf(e))||r===Object.prototype)}const W="https://restcountries.com/v3.1",$=["Africa","Americas","Antarctic","Asia","Europe","Oceania"],Q="region",V="search";export{W as A,Q as R,V as S,$ as a,z as b,L as c,J as u};
